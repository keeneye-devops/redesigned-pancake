CREATE DEFINER=```root```@```%``` TRIGGER `SLA_CREATOR` AFTER INSERT ON `ea_wpsp_ticket` FOR EACH ROW BEGIN declare SLA date; declare nextMonday date; declare nextDay date; declare today date; set @nextDay=concat(ADDDATE(NOW(), +1), ' 10:00:00'); set @nextMonday=concat(DATE_ADD(NOW(), INTERVAL (9 - DAYOFWEEK(NOW())) DAY), ' 10:00:00'); set @today=concat(NOW(), ' 10:00:00'); if (new.cat_id in (1)) then -- Bug set @SLA="2:00:00.000000"; elseif (new.cat_id=8) then -- Op. Task set @SLA="24:00:00.000000"; else set @SLA="00:00:00.000000"; end if; if (new.priority_id in (1)) then INSERT INTO erp_access_req.be_sla_manager (ticket_id ,end_time ) values (new.id,ADDTIME(NOW(), "24:00:00.000000")); end if; END
